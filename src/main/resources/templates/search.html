<!DOCTYPE html>
<html lang="ko" layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title> 그린워커에 오신 것을 환영합니다 </title>
    <link rel="stylesheet" href="/searchwindow.css">
</head>
<body>
<div layout:fragment="content">
    <div class="main-wrap">
        <div class="content-wrap">
            <div class="locationlist">
                <div>
                    <form th:action="@{/target/search}" method="post">
                    <div>
                        <select class="defaultstarting form-select form-select-lg mb-3" aria-label="Large select example">
                            <option value="home"> 집 </option>
                            <option value="company"> 회사 </option>
                            <option value="favorite"> 즐겨찾기 </option>
                        </select>
                    </div>
                    <div>
                        출발지점 <input type="text" id="pstarting" name="pstarting" th:value="${pname1}">
                        <button type = "button" id = "selectstarting"> 출발지점설정 </button>
                        <input type="text" id = "pname1" name = "pname1" th:value="${pname1}">
                        <input type="text" id = "paddress1" name = "paddress1" th:value="${paddress1}">
                        <input type="text" id = "latclick1" name = "latclick1" th:value="${latclick1}">
                        <input type="text" id = "lngclick1" name = "lngclick1" th:value="${lngclick1}">
                    </div>

                    <div>
                        탐색하고자 하는 반경거리를 입력해주세요 <br/>
                        <select name ="radius" class=" form-select form-select-lg mb-3" aria-label="Large select example">
                            <option value="1"> 1km </option>
                            <option value="2"> 2km </option>
                            <option value="3"> 3km </option>
                            <option value="4"> 4km </option>
                            <option value="5"> 5km </option>
                            <option value="6"> 6km </option>
                            <option value="7"> 7km </option>
                            <option value="8"> 8km </option>
                            <option value="9"> 9km </option>
                            <option value="10"> 10km </option>
                        </select>
                    </div>
                    <div>
                        <button type = "submit" id = "searchtarget"> 목적지 탐색하기 </button>
                    </div>
                    </form>
                    <div>
                        도착지점 <input type="text" id="pdestination" name="pdestination">
                        <button type = "button" id = "selectdestination"> 도착지점설정 </button>
                        <input type="text" id="pname2" name="pname2" value="">
                        <input type="text" id="paddress2" name="paddress2" value="">
                        <input type="text" id="latclick2" name="latclick2" value="">
                        <input type="text" id="lngclick2" name="lngclick2" value="">
                    </div>
                    <div>
                        출발지점부터 목적지까지의 거리 </br>
                        <input type="text" id="pdistance" name="pdistance" >
                    </div>
                    <div>
                        <button type = "button" id = "adventure"> 탐험하기 </button>
                    </div>
                </div>
                    <div>
                        <!-- 위도 및 경도 좌표 및 위치정보 -->
                        현재 선택한 장소
                        <input type="text" id="fulladdress" name="fulladdress" style="width:100%;" disabled>
                        <input type="text" id="pname" name="pname" value="" disabled>
                        <input type="text" id="paddress" name="paddress" value="" disabled>
                        <input type="text" id="latclick" name="latclick" value="" disabled>
                        <input type="text" id="lngclick" name="lngclick" value="" disabled>
                    </div>
                    <table>
                        <h4> 반경 이내의 장소입니다. </h4>
                        <thead>
                            <tr>
                                <th>장소명</th>
                                <th>주소</th>
                                <th>위도</th>
                                <th>경도</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="searchresult : ${searchresult}">
                                <td th:text="${searchresult.locationName}"></td>
                                <td th:text="${searchresult.locationAddress}"></td>
                                <td th:text="${searchresult.locationLat}"></td>
                                <td th:text="${searchresult.locationLng}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            <div class="mapside">
                <div id="wrapper">

                    <div class="map_wrap">
                        <div id="map" style="width:100%;height:100%;position:relative;overflow:hidden;"></div>
                        <div id="menu_wrap" class="bg_white">
                            <div class="option">
                                <div>
                                    키워드 : <input type="text" value="대전 IT아카데미" id="keyword" size="15">
                                    <button onclick="searchPlaces(); return false;">검색하기</button>
                                </div>
                            </div>
                            <hr>
                            <ul id="placesList"></ul>
                            <div id="pagination"></div>
                        </div>
                    </div>

                    <script type="text/javascript"
                            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c643afa51aa20879e433287a3b49c7a7&libraries=services"></script>

                    <!-- 타임리프 변수를 자바스크립트 내부에서 사용하기 위해 th:inline="javascript"를 선언합니다. -->
                    <!-- 카카오지도 키워드 검색  -->
                    <script th:inline="javascript" src="/keyword_map_search.js"></script>

                    <script th:inline="javascript">
                    // **** 유저가 입력한 searchresult가 존재한다면 해당값들을 다중 마커로 표시하는 함수입니다. ****

                    // 유저 검색결과용 커스텀 오버레이 생성
                    var overlay = new kakao.maps.CustomOverlay({
                        clickable: true,
                        yAnchor: 1.2
                    });

                    /*[# th:each="searchResult : ${searchresult}"]*/

                    var marker = new kakao.maps.Marker({
                        map: map,
                        position: new kakao.maps.LatLng('[[${searchResult.locationLat}]]', '[[${searchResult.locationLng}]]')
                    });

                    // 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
                    (function(marker, overlay, id, locationCategory, locationName, locationAddress, locationLat, locationLng) {

                    // 커스텀 오버레이 UI
                    var content = '<a href="/targetinfo/' + id + '" target="_blank">' +
                    '		       <div class = "wrap">' +
                        '					<div class = "classimg"><img src = "/samplelogo.jpg" width="160" height="160" style="border-top-left-radius:15px; border-top-right-radius:15px;"></div>' +
                                   '        <div class="classinfo">' +
                                    '            <div class="classtitle">' + locationName + '</div>' +
                                    '            <div class="classfounder">' + locationAddress + '</div>' +
                                    '            <div class="classpay">' + locationCategory + '</div>' +
                                    '            <div class="classse"> 기간(더미 데이터) </div>' +
                                 '        </div>' +
                        '			   </div>' +
                    ' 			   </a>';

                    // 마커를 클릭하면 발생하는 이벤트
                    kakao.maps.event.addListener(marker, 'click', function() {

                        overlay.setContent(content);
                        overlay.setPosition(new kakao.maps.LatLng(locationLat, locationLng));
                        overlay.setMap(map);

                        // 1. 주소 정보들을 text 영역으로 전송 (hidden 사용)
                        document.getElementById('fulladdress').value = "[" + locationName + "]" + locationAddress;
                        document.getElementById('pname').value = locationName;
                        document.getElementById('paddress').value = locationAddress;
                        document.getElementById('latclick').value = locationLat;
                        document.getElementById('lngclick').value = locationLng;
                    });

                    // 마우스로 지도를 누르면 발생하는 이벤트
                    // 커스텀 오버레이 창 닫기
                    kakao.maps.event.addListener(map, 'click', function() {
                        overlay.setMap(null);
                    });

                    })(marker, overlay, [[${searchResult.id}]], [[${searchResult.locationCategory}]], [[${searchResult.locationName}]],
                    [[${searchResult.locationAddress}]], [[${searchResult.locationLat}]], [[${searchResult.locationLng}]]);

                    /*[/]*/

                    </script>

                    <script>
                        document.getElementById("selectstarting").addEventListener('click', getstarting);
                        function getstarting(){
                                 document.getElementById('pstarting').value = document.getElementById('fulladdress').value;
                                 document.getElementById('pname1').value = document.getElementById('pname').value;
                                 document.getElementById('paddress1').value = document.getElementById('paddress').value;
                                 document.getElementById('latclick1').value = document.getElementById('latclick').value;
                                 document.getElementById('lngclick1').value = document.getElementById('lngclick').value;
                                 alert("출발 지점의 정보를 가져옵니다.");
                        }

                        document.getElementById("selectdestination").addEventListener('click', getdestination);
                        function getdestination(){
                                 document.getElementById('pdestination').value = document.getElementById('fulladdress').value;
                                 document.getElementById('pname2').value = document.getElementById('pname').value;
                                 document.getElementById('paddress2').value = document.getElementById('paddress').value;
                                 document.getElementById('latclick2').value = document.getElementById('latclick').value;
                                 document.getElementById('lngclick2').value = document.getElementById('lngclick').value;
                                alert("도착 지점의 정보를 가져옵니다.");
                        }

                        document.getElementById("adventure").addEventListener('click', adventurestart);
                        function adventurestart(){
                                alert("탐험을 시작합니다");
                                searchDetailAddrFromCoords(presentPosition, function(result, status) {

                                // ===는 일치 연산자로, 값과 자료형이 완전히 일치하는지를 검사합니다.
                                // 이것은 느슨한 동등 비교 (==)와 달리 자료형까지 비교합니다.

                                if (status === kakao.maps.services.Status.OK) {
                                    window.open('https://map.kakao.com/?target=walk&sName=' + document.getElementById('pname1').value + '&eName=' + document.getElementById('pname2').value);
                                    }
                                });
                        }
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>